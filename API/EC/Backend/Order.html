<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>EC管理後台</title>
</head>
<script src="../Resource/js/jquery-1.11.0.min.js" type="text/javascript"></script>
<script>

    function init(){
        $.ajax({            
          method: "POST",
          url: "API/LoginCheck.php",
          data:{},            
          dataType: "text",
          success: function (response) {
              if(response == ""){
                alert('請先登入，將前往登入頁'); 
                location.href = 'Login.html';                
              }else{
                getData();
              }
          },
          error: function(exception) {
              alert("數據載入失敗: " + exception.status);
          }
      });
    }

    function getData(){    
        $.ajax({            
            method: "POST",
            url: "API/Order.php",
            data:{},            
            dataType: "json",
            success: function (response) {
                display(response);             
            },
            error: function(exception) {
                alert("數據載入失敗: " + exception.status);
            }
        });
    }

    function display(response){
        //更新html內容(透過jQuery跑迴圈取值)
        $.each(response, function(index, row) {
            $("#result").append(
                "<tr>" +
                    "<td align='center'>" + row.ID + "</td>" +
                    "<td align='center'>" + row.Account + "</td>" +                                    
                    "<td align='center'>" + row.OrderNumber + "</td>" +
                    "<td align='center'>" + row.Amount + "</td>" +
                    "<td align='center'>" + row.CreateDate + "</td>" +                    
                    "<td align='center'><a href='OrderDetail.html?OID=" + row.ID + "'>明細</a></td>" +                    
                "</tr>"
            );
        });
    }

</script>

<body onload="init()">
    <table align="center">        
        <tr>
            <td colspan="2" align="center">
                <font size="5">EC訂單管理</font>
            </td>
        </tr>

        <tr>
            <td colspan="2" height="15"><br /></td>
        </tr>

        <tr>
            <td width="150">
                <a href="Category.html">[商品分類管理]</a><br>
                <a href="Product.html">[商品管理]</a><br>
                <a href="Order.html">[訂單列表]</a>
            </td>
            <td width="800">
                <table>
                    <tr>
                        <td></td>
                        <td align="right"><input type="button" value="帳號登出" onclick="javascript: location.href = 'API/Logout.php';" /></td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <table id="result" align="center" letter-spacing: 5px; " cellpadding=" 0" cellspacing="0" border="1">
                                <tr style="background-color:#FFF0F5;">
                                    <td align="center">流水號</td>
                                    <td align="center">會員帳號</td> 
                                    <td align="center">訂單編號</td>                                    
                                    <td align="center">金額</td>
                                    <td align="center">日期</td>
                                    <td align="center"></td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
</body>