<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>EC管理後台</title>
</head>
<script src="../Resource/js/jquery-1.11.0.min.js" type="text/javascript"></script>
<script>

    function init(){
        $.ajax({            
          method: "POST",
          url: "API/LoginCheck.php",
          data:{},            
          dataType: "text",
          success: function (response) {
              if(response == ""){
                alert('請先登入，將前往登入頁'); 
                location.href = 'Login.html';                
              }else{
                getData();
              }
          },
          error: function(exception) {
              alert("數據載入失敗: " + exception.status);
          }
      });
    }

    function getData(){    
        $.ajax({            
            method: "POST",
            url: "API/Product.php",
            data:{},            
            dataType: "json",
            success: function (response) {
                display(response);              
            },
            error: function(exception) {
                alert("數據載入失敗: " + exception.status);
            }
        });
    }

    function display(response){
        //更新html內容(透過jQuery跑迴圈取值)
        $.each(response, function(index, row) {

            var status;
            switch(row.Status){
                case 0:
                    status = "已刪除";
                    break;
                case 1: 
                    status = "<font color='red'>下架</font>";
                    break;
                case 2: 
                    status = "<font color='green'>上架</font>";
                    break;                
            }

            //防呆判斷顯示
            var UpdateDate = row.UpdateDate == null ? "" : row.UpdateDate;

            $("#result").append(
                "<tr>" +
                    "<td align='center'>" + row.ID + "</td>" +
                    "<td align='center'>" + row.CateName + "</td>" +                                    
                    "<td align='center'>" + row.ProductName + "</td>" +
                    "<td align='center'>" + row.Price + "</td>" +
                    "<td align='center'>" + status + "</td>" +
                    "<td align='center'><img src='../Upload/" + row.PictureName + "' width='200'/></td>" +
                    "<td align='center'>" + row.CreateDate + "</td>" +
                    "<td align='center'>" + UpdateDate + "</td>" +
                    "<td align='center'><a href='ProductUpdate.html?PID=" + row.ID + "'>修改</a></td>" +
                    "<td align='center'><a href='API/ProductDelete.php?PID=" + row.ID + "' onclick=\"javascript:if(confirm('確定刪除?')){ return true; } else { return false; }\">刪除</a></td>" +
                "</tr>"
            );
        });
    }    

</script>

<body onload="init()">
    <table align="center">        
        <tr>
            <td colspan="2" align="center">
                <font size="5">EC商品管理</font>
            </td>
        </tr>

        <tr>
            <td colspan="2" height="15"><br /></td>
        </tr>

        <tr>
            <td width="150">
                <a href="Category.html">[商品分類管理]</a><br>
                <a href="Product.html">[商品管理]</a><br>
                <a href="Order.html">[訂單列表]</a>
            </td>
            <td width="800">
                <table>
                    <tr>
                        <td><input type="button" value="新增商品" onclick="javascript: location.href = 'ProductCreate.html'" /></td>
                        <td align="right"><input type="button" value="帳號登出" onclick="javascript: location.href = 'API/Logout.php';" /></td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <table id="result" align="center" letter-spacing: 5px; " cellpadding=" 0" cellspacing="0" border="1">
                                <tr style="background-color:#FFF0F5;">
                                    <td align="center">流水號</td>
                                    <td align="center">分類</td>                                    
                                    <td align="center">商品名稱</td>
                                    <td align="center">商品金額</td>
                                    <td align="center">狀態</td>
                                    <td align="center">商品圖</td>
                                    <td align="center">建立時間</td>
                                    <td align="center">更新時間</td>
                                    <td align="center"></td>
                                    <td align="center"></td>
                                </tr>                                
                            </table>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
</body>