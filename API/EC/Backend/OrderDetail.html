<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>EC管理後台</title>
</head>
<script src="../Resource/js/jquery-1.11.0.min.js" type="text/javascript"></script>
<script>

    function init(){
        $.ajax({            
          method: "POST",
          url: "API/LoginCheck.php",
          data:{},            
          dataType: "text",
          success: function (response) {
              if(response == ""){
                alert('請先登入，將前往登入頁'); 
                location.href = 'Login.html';                
              }else{
                getData();
              }
          },
          error: function(exception) {
              alert("數據載入失敗: " + exception.status);
          }
      });
    }

    function getData(){    

        //在html頁面上取得GET(QueryString)的值
        var OID = (new URL(location.href)).searchParams.get('OID');

        $.ajax({            
            method: "POST",
            url: "API/OrderByID.php",
            data:{OID: OID},           
            dataType: "json",
            success: function (response) {
                display(response);              
            },
            error: function(exception) {
                alert("數據載入失敗: " + exception.status);
            }
        });
    }

    function display(response){
        //更新html內容(透過jQuery跑迴圈取值)
        $.each(response, function(index, row) {
            $("#result").append(
                "<tr>" +
                    "<td align='center'><img src='../Upload/" + row.PictureName + "' width='100' height='100'></td>" +                    
                    "<td align='center'>" + row.ProductName + "</td>" +                                    
                    "<td align='center'>" + row.QTY + "</td>" +                  
                "</tr>"
            );
        });
    }

</script>

<body onload="init()">
    <table align="center">        
        <tr>
            <td colspan="2" align="center">
                <font size="5">EC訂單管理</font>
            </td>
        </tr>

        <tr>
            <td colspan="2" height="15"><br /></td>
        </tr>

        <tr>
            <td colspan="2" align="center">
                <table>
                    <tr>
                        <td></td>
                        <td align="right"></td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <table id="result" align="center" letter-spacing: 5px; " cellpadding=" 0" cellspacing="0" border="1">
                                <tr style="background-color:#FFF0F5;">
                                    <td align="center">商品圖</td>
                                    <td align="center">商品名稱</td>                                    
                                    <td align="center">數量</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
</body>